apiVersion: fineract.apache.org/v1
kind: FinancialReport
metadata:
  name: portfolio-analysis-by-branch
  labels:
    report-category: financial
spec:
  reportName: Portfolio Analysis by Branch
  reportType: Balance Sheet
  useReport: true
  reportSql: "SELECT\n    o.name as office_name,\n    COUNT(l.id) as loan_count,\n\
    \    SUM(l.principal_amount) as total_principal,\n    SUM(l.principal_outstanding_derived)\
    \ as outstanding,\n    SUM(l.principal_repaid_derived) as repaid,\n    COUNT(DISTINCT\
    \ l.client_id) as unique_clients\nFROM m_loan l\nJOIN m_office o ON l.office_id\
    \ = o.id\nWHERE l.loan_status_id IN (200, 300)\nGROUP BY o.name\nORDER BY total_principal\
    \ DESC"
