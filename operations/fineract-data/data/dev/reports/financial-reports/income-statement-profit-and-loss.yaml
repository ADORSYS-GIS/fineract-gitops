apiVersion: fineract.apache.org/v1
kind: FinancialReport
metadata:
  name: income-statement-(profit-&-loss)
  labels:
    report-category: financial
spec:
  reportName: Income Statement (Profit & Loss)
  reportType: Balance Sheet
  useReport: true
  reportSql: "SELECT\n    'REVENUE' as category,\n    'Interest Income' as line_item,\n\
    \    SUM(l.interest_charged_derived) as amount\nFROM m_loan l\nWHERE l.loan_status_id\
    \ = 300\nUNION ALL\nSELECT\n    'REVENUE' as category,\n    'Fee Income' as line_item,\n\
    \    SUM(l.fee_charges_charged_derived) as amount\nFROM m_loan l\nWHERE l.loan_status_id\
    \ = 300\nUNION ALL\nSELECT\n    'EXPENSES' as category,\n    'Loan Loss Provision'\
    \ as line_item,\n    SUM(CASE\n        WHEN DATEDIFF(CURDATE(), l.overdue_since_date_derived)\
    \ > 180 THEN l.principal_outstanding_derived * 1.0\n        WHEN DATEDIFF(CURDATE(),\
    \ l.overdue_since_date_derived) > 90 THEN l.principal_outstanding_derived * 0.75\n\
    \        WHEN DATEDIFF(CURDATE(), l.overdue_since_date_derived) > 30 THEN l.principal_outstanding_derived\
    \ * 0.50\n        WHEN DATEDIFF(CURDATE(), l.overdue_since_date_derived) > 0 THEN\
    \ l.principal_outstanding_derived * 0.25\n        ELSE 0\n    END) as amount\n\
    FROM m_loan l\nWHERE l.loan_status_id = 300"
