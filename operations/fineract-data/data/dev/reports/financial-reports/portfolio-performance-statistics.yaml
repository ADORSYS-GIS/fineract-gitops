apiVersion: fineract.apache.org/v1
kind: FinancialReport
metadata:
  name: portfolio-performance-statistics
  labels:
    report-category: financial
spec:
  reportName: Portfolio Performance Statistics
  reportType: Balance Sheet
  useReport: true
  reportSql: "SELECT\n    COUNT(DISTINCT l.id) as total_loans,\n    COUNT(DISTINCT\
    \ CASE WHEN l.loan_status_id = 300 THEN l.id END) as active_loans,\n    SUM(l.principal_disbursed_derived)\
    \ as total_disbursed,\n    SUM(l.principal_outstanding_derived) as total_outstanding,\n\
    \    SUM(l.principal_repaid_derived) as total_repaid,\n    AVG(l.principal_amount)\
    \ as avg_loan_size,\n    (SUM(l.principal_repaid_derived) / SUM(l.principal_disbursed_derived)\
    \ * 100) as repayment_rate,\n    p.name as product_name\nFROM m_loan l\nJOIN m_product_loan\
    \ p ON l.product_id = p.id\nGROUP BY p.name"
