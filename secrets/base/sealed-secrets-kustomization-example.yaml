# Example Kustomization for Including Sealed Secrets
#
# This file shows how to include sealed secrets in your environment's kustomization.yaml
# Copy the relevant sections to your environments/[env]/kustomization.yaml

# For DEV environment (environments/dev/kustomization.yaml):
# Add these resources BEFORE other components:

resources:
  # Namespace (created first)
  - namespace.yaml

  # Sealed Secrets (created second, before any pods need them)
  - ../../secrets/dev/fineract-db-credentials-sealed.yaml
  - ../../secrets/dev/keycloak-db-credentials-sealed.yaml
  - ../../secrets/dev/keycloak-admin-credentials-sealed.yaml
  - ../../secrets/dev/oauth2-proxy-secrets-sealed.yaml
  - ../../secrets/dev/s3-connection-sealed.yaml
  - ../../secrets/dev/fineract-redis-secret-sealed.yaml
  - ../../secrets/dev/fineract-admin-credentials-sealed.yaml
  - ../../secrets/dev/keycloak-client-secrets-sealed.yaml  # Optional - populated by job

  # Database initialization (ArgoCD PreSync hook, runs before Fineract)
  - ../../operations/database-init/base

  # Fineract application
  - ../../apps/fineract/base

# For Grafana secrets (monitoring namespace):
# Add to your monitoring kustomization or create a separate one:

# resources:
#   - ../../secrets/dev/grafana-admin-credentials-sealed.yaml

# ============================================================================
# For UAT environment (environments/uat/kustomization.yaml):
# ============================================================================

# resources:
#   - namespace.yaml
#
#   # Sealed Secrets for UAT
#   - ../../secrets/uat/fineract-db-credentials-sealed.yaml
#   - ../../secrets/uat/keycloak-db-credentials-sealed.yaml
#   - ../../secrets/uat/keycloak-admin-credentials-sealed.yaml
#   - ../../secrets/uat/oauth2-proxy-secrets-sealed.yaml
#   - ../../secrets/uat/s3-connection-sealed.yaml
#   - ../../secrets/uat/fineract-redis-secret-sealed.yaml
#   - ../../secrets/uat/fineract-admin-credentials-sealed.yaml
#   - ../../secrets/uat/keycloak-client-secrets-sealed.yaml
#
#   - ../../operations/database-init/base
#   - ../../apps/fineract/base

# ============================================================================
# For PRODUCTION environment (environments/production/kustomization.yaml):
# ============================================================================

# resources:
#   - namespace.yaml
#
#   # Sealed Secrets for PRODUCTION
#   - ../../secrets/production/fineract-db-credentials-sealed.yaml
#   - ../../secrets/production/keycloak-db-credentials-sealed.yaml
#   - ../../secrets/production/keycloak-admin-credentials-sealed.yaml
#   - ../../secrets/production/oauth2-proxy-secrets-sealed.yaml
#   - ../../secrets/production/s3-connection-sealed.yaml
#   - ../../secrets/production/fineract-redis-secret-sealed.yaml
#   - ../../secrets/production/fineract-admin-credentials-sealed.yaml
#   - ../../secrets/production/keycloak-client-secrets-sealed.yaml
#
#   - ../../operations/database-init/base
#   - ../../apps/fineract/base

# ============================================================================
# Notes:
# ============================================================================
#
# 1. Sealed secrets MUST be created before referencing them here
# 2. Run the secret generation scripts first:
#    ./scripts/seal-terraform-secrets.sh dev
#    ./scripts/create-complete-sealed-secrets.sh dev
#
# 3. Sealed secrets are environment-specific (encrypted per cluster)
# 4. Each environment needs its own set of sealed secrets
# 5. Commit sealed secrets to Git - they are safe to commit
#
# 6. The Sealed Secrets controller must be deployed BEFORE applying this:
#    kubectl apply -k apps/sealed-secrets-controller/base/
#
# 7. Or via ArgoCD:
#    kubectl apply -f argocd/applications/system/sealed-secrets-controller.yaml
