---
# OAuth2 Proxy Public Endpoints (no authentication required)
# This ingress handles OAuth2 flow endpoints that must be accessible without auth
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: fineract-oauth2-public
  labels:
    app: fineract
    component: ingress
    purpose: oauth2-public-endpoints
  annotations:
    # SSL/TLS Configuration
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    nginx.ingress.kubernetes.io/ssl-protocols: "TLSv1.2 TLSv1.3"

    # cert-manager - automatic certificate management
    cert-manager.io/cluster-issuer: "cluster-issuer"

    # Backend protocol
    nginx.ingress.kubernetes.io/backend-protocol: "HTTP"

    # Proxy headers for OAuth2 callback redirects
    nginx.ingress.kubernetes.io/configuration-snippet: |
      more_set_headers "X-Forwarded-Host: $host";
      more_set_headers "X-Forwarded-Port: 443";
      more_set_headers "X-Forwarded-Proto: https";

spec:
  ingressClassName: nginx

  tls:
  - hosts:
    - apps-hostname
    secretName: fineract-tls

  rules:
  - host: apps-hostname
    http:
      paths:

      # OAuth2 Proxy endpoints (no auth required for OAuth flow)
      - path: /oauth2
        pathType: Prefix
        backend:
          service:
            name: oauth2-proxy
            port:
              number: 4180