apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: fineract-production-aws

# Production Environment with AWS Managed Services
#
# Uses AWS managed services instead of self-hosted:
# - RDS PostgreSQL instead of StatefulSet
# - In-cluster Redis (fineract-redis) for sessions
# - S3 for object storage
#
# Prerequisites: Terraform must provision AWS resources first
# Security: Manual sync required with approval, business hours sync windows
# Deploys from main branch with tagged releases

namespace: fineract-production

# Inherit common configuration from base
bases:
  - ../base

resources:
  # Namespace (created first)
  - namespace.yaml

# Patches to inject environment-specific configuration
patches:
  # OAuth2/Fineract configuration - environment-specific URLs
  - path: fineract-oauth2-config-patch.yaml
    target:
      kind: ConfigMap
      name: fineract-oauth2-config

# Production-Specific Image Overrides
# Override base images with production-specific versions
images:
  # Apache Fineract - Core Banking Platform
  # Using stable release tested in UAT
  # Note: 1.13.0 doesn't exist yet, using proven 1.12.1
  - name: apache/fineract
    newName: apache/fineract
    newTag: "1.12.1"

  # Custom Images
  # --------------------------------------------------------

  # fineract-keycloak-sync - User Sync Service
  - name: fineract-keycloak-sync
    newName: fineract-keycloak-sync
    newTag: "v1.0.0"

# Production-Specific Labels
commonLabels:
  environment: production
  criticality: high

# Production-Specific Annotations
commonAnnotations:
  environment: production
  auto-sync: "disabled"
  approval-required: "true"
  sync-windows: "business-hours-only"
  contact: "platform-team@example.com"
  oncall: "sre-team@example.com"
