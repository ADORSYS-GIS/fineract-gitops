apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: fineract-uat-aws

# UAT (User Acceptance Testing) Environment with AWS Managed Services
#
# Uses AWS managed services instead of self-hosted:
# - RDS PostgreSQL instead of StatefulSet
# - In-cluster Redis (fineract-redis) for sessions
# - S3 for object storage
#
# Prerequisites: Terraform must provision AWS resources first
# Configuration: Production-like for testing, manual sync required

namespace: fineract-uat

# Inherit common configuration from base
bases:
  - ../base

resources:
  # Namespace (created first)
  - namespace.yaml

# Patches to inject environment-specific configuration
patches:
  # OAuth2/Fineract configuration - environment-specific URLs
  - path: fineract-oauth2-config-patch.yaml
    target:
      kind: ConfigMap
      name: fineract-oauth2-config

# UAT-Specific Image Overrides
# Override base images with UAT-specific versions
images:
  # Apache Fineract - Core Banking Platform
  # Using stable release for UAT testing before production
  # Note: 1.13.0 doesn't exist yet, using 1.12.1
  - name: apache/fineract
    newName: apache/fineract
    newTag: "1.12.1"

  # Custom Images
  # --------------------------------------------------------

  # fineract-keycloak-sync - User Sync Service
  - name: fineract-keycloak-sync
    newName: fineract-keycloak-sync
    newTag: "v1.0.0"

# UAT-Specific Labels
commonLabels:
  environment: uat
  # NEW: Cost tracking labels
  cost-center: "qa-testing"
  team: "qa"
  owner: "qa-team"
  component: "testing"
  workload: "testing"
  auto-stop: "true"
  billing-code: "UAT-001"

# UAT-Specific Annotations
commonAnnotations:
  environment: uat
  auto-sync: "disabled"
  approval-required: "true"
  contact: "qa-team@example.com"
