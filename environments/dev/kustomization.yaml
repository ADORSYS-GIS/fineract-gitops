apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: fineract-dev-aws

# Development Environment with AWS Managed Services
#
# Uses AWS managed services instead of self-hosted:
# - RDS PostgreSQL instead of StatefulSet
# - In-cluster Redis (fineract-redis) for sessions
# - S3 for object storage
#
# Prerequisites: Terraform must provision AWS resources first
# Benefits: ~73% cost savings, no database operations

namespace: fineract-dev

# Inherit common configuration from base
bases:
  - ../base

resources:
  # Namespace (created first)
  - namespace.yaml

# Patches to inject environment-specific configuration
patches:
  # OAuth2/Fineract configuration - environment-specific URLs
  - path: fineract-oauth2-config-patch.yaml
    target:
      kind: ConfigMap
      name: fineract-oauth2-config

  # IRSA (IAM Roles for Service Accounts) configuration
  # Injects the IAM role ARN created by Terraform into the Fineract service account
  # This enables Fineract pods to assume AWS IAM roles for S3 and RDS access
  - path: fineract-irsa-patch.yaml
    target:
      kind: ServiceAccount
      name: fineract-aws

# Dev-Specific Image Overrides
# Override base images with dev-specific versions
images:
  # Apache Fineract - Core Banking Platform
  # Using develop tag to test latest features and ICU bug fixes
  - name: apache/fineract
    newName: apache/fineract
    newTag: "develop"

  # Frontend Applications (dev-only for now)
  # --------------------------------------------------------

  # Reporting App - Read-only reporting and audit trail
  # Built from: https://github.com/ADORSYS-GIS/fineract-apps
  # Workflow: .github/workflows/publish-frontend-images.yml
  # Deployed via: argocd/applications/dev/reporting-app.yaml
  - name: ghcr.io/adorsys-gis/fineract-reporting-app
    newName: ghcr.io/adorsys-gis/fineract-reporting-app
    newTag: "latest"

  # Accounting App - Financial accounting and ledger management
  # Built from: https://github.com/ADORSYS-GIS/fineract-apps
  # Workflow: .github/workflows/publish-frontend-images.yml
  # Deployed via: argocd/applications/dev/accounting-app.yaml
  - name: ghcr.io/adorsys-gis/fineract-accounting-app
    newName: ghcr.io/adorsys-gis/fineract-accounting-app
    newTag: "latest"

# Dev-Specific Labels
commonLabels:
  environment: dev
  # NEW: Cost tracking labels
  cost-center: "development"
  team: "engineering"
  owner: "platform-team"
  component: "compute"
  workload: "development"
  auto-stop: "true"
  billing-code: "DEV-001"

# Dev-Specific Annotations
commonAnnotations:
  environment: development
  auto-sync: "enabled"
  contact: "dev-team@example.com"
