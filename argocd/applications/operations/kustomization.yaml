apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# ArgoCD Applications for Fineract Operations
#
# This kustomization deploys Applications that manage operational components:
# - Keycloak configuration
# - Fineract data loading operations (per environment)
# - Database initialization
#
# Uses Kustomize replacements to centralize repository URL
#
# Usage:
#   kubectl apply -k argocd/applications/operations

resources:
  - argocd-config.yaml
  # Removed duplicates that are managed by environment-specific app-of-apps:
  # - keycloak-config.yaml (managed by argocd/applications/dev/keycloak-config.yaml)
  # - database-init.yaml (managed by argocd/applications/dev/database-fineract-init.yaml)
  # - database-setup.yaml (managed by argocd/applications/dev/database-keycloak-setup.yaml)

# Replacements to inject repository URL into all Application manifests
replacements:
  # Replace repoURL in all Applications
  - source:
      kind: ConfigMap
      name: argocd-app-config
      fieldPath: data.repoURL
    targets:
      - select:
          kind: Application
        fieldPaths:
          - spec.source.repoURL

  # Replace targetRevision in all Applications
  - source:
      kind: ConfigMap
      name: argocd-app-config
      fieldPath: data.targetRevision
    targets:
      - select:
          kind: Application
        fieldPaths:
          - spec.source.targetRevision

commonLabels:
  app.kubernetes.io/managed-by: argocd
  app.kubernetes.io/part-of: fineract-operations

# Namespace where these Applications will be created
namespace: argocd
